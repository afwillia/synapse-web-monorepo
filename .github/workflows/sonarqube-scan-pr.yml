on:
  # Warning: using the pull_request_target event without the cautionary measures may allow
  # unauthorized GitHub users to open a “pwn request” and exfiltrate secrets.
  pull_request_target:
    types: [opened, synchronize, reopened]

name: SonarCloud Code Scan
jobs:
  # For monorepos, create one job per project and specify the directory
  sonarqube-src:
    environment: ${{ github.event_name == 'pull_request_target' &&
      github.event.pull_request.head.repo.full_name != github.repository && 'sonar-pr' || 'none' }}
    name: scan-synapse-react-client
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          # Disabling shallow clones is recommended for improving the relevancy of reporting
          # By default, actions/checkout@v4 checks out the main branch instead of the merge
          # commit when using pull_request_target.
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}
      - name: SonarQube Scan
        uses: SonarSource/sonarqube-scan-action@v5
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        with:
          projectBaseDir: packages/synapse-react-client
